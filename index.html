<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Eco Karaoke</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  background: black;
  color: white;
  font-family: Arial, sans-serif;
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 100vh;
  text-align: center;
  padding: 10px;
}

h1 {
  font-size: clamp(2rem, 5vw, 4rem);
  margin: 15px 0;
}

#hint {
  opacity: 0.7;
  margin-bottom: 10px;
}

#display {
  font-size: clamp(2rem, 8vw, 5rem);
  letter-spacing: 0.4em;
  margin-bottom: 15px;
}

#queue {
  margin-bottom: 15px;
  font-size: 1.2rem;
  max-width: 90vw;
  word-wrap: break-word;
}

video {
  width: 90vw;
  max-width: 1200px;
  border: 3px solid white;
  border-radius: 10px;
  background: black;
  margin-bottom: 20px;
}

/* Keypad */
#keypad {
  display: grid;
  grid-template-columns: repeat(3, 80px);
  gap: 10px;
  margin-bottom: 20px;
}

#keypad button {
  font-size: 1.5rem;
  padding: 15px;
  background: #111;
  color: white;
  border: 2px solid white;
  border-radius: 10px;
}

#keypad button:active {
  background: #444;
}

footer {
  opacity: 0.6;
  margin-top: auto;
}
</style>
</head>

<body>

<h1>Eco Karaoke</h1>
<div id="hint">Enter 4-digit song number → OK</div>
<div id="display">____</div>
<div id="queue">Queue: (empty)</div>

<video id="player" controls playsinline></video>

<!-- Touch / Phone Keypad -->
<div id="keypad">
  <button data-key="1">1</button>
  <button data-key="2">2</button>
  <button data-key="3">3</button>
  <button data-key="4">4</button>
  <button data-key="5">5</button>
  <button data-key="6">6</button>
  <button data-key="7">7</button>
  <button data-key="8">8</button>
  <button data-key="9">9</button>
  <button data-key="clear">CLR</button>
  <button data-key="0">0</button>
  <button data-key="enter">OK</button>
</div>

<footer>Created by <b>Eco, John Michael S.</b></footer>

<script>
/* ================= CONFIG ================= */
const serverUrl = "https://microchemical-typologically-phebe.ngrok-free.dev/videos/";

const videos = {
  "0001": "Tensionado.mp4",
  "0002": "thinking-out-loud.mp4",
  "0003": "shape-of-you.mp4"
};

/* ================= STATE ================= */
let input = "";
let queue = [];

const display = document.getElementById("display");
const queueDiv = document.getElementById("queue");
const player = document.getElementById("player");

/* ================= UI ================= */
function updateDisplay() {
  display.textContent = input.padEnd(4, "_");
}

function updateQueue() {
  queueDiv.textContent =
    queue.length === 0
      ? "Queue: (empty)"
      : "Queue: " + queue.map((v, i) => `${i+1}. ${v}`).join(" | ");
}

/* ================= PLAYBACK ================= */
function playNext() {
  if (queue.length === 0) return;

  const next = queue.shift();
  player.src = serverUrl + next;
  updateQueue();

  player.play().catch(() => {
    console.log("Waiting for user interaction");
  });
}

player.addEventListener("ended", playNext);

/* ================= INPUT CORE ================= */
function addDigit(d) {
  if (input.length < 4) {
    input += d;
    updateDisplay();
  }
}

function submitCode() {
  if (input.length === 4 && videos[input]) {
    queue.push(videos[input]);
    if (player.paused) playNext();
  }
  input = "";
  updateDisplay();
  updateQueue();
}

function clearInput() {
  input = "";
  updateDisplay();
}

/* ================= KEYBOARD + WEBOS REMOTE ================= */
document.addEventListener("keydown", (e) => {
  const code = e.keyCode;

  if (code >= 48 && code <= 57) addDigit(String(code - 48)); // 0–9
  if (code === 13) submitCode(); // OK
  if (code === 8 || code === 27 || code === 461) clearInput(); // Back
});

/* ================= PHONE / TOUCH ================= */
document.querySelectorAll("#keypad button").forEach(btn => {
  btn.addEventListener("click", () => {
    const key = btn.dataset.key;
    if (key === "enter") submitCode();
    else if (key === "clear") clearInput();
    else addDigit(key);
  });
});

/* Init */
updateDisplay();
updateQueue();
</script>

</body>
</html>
